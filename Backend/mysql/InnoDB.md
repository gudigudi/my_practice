
# InnoDB存储引擎简介

## InnoDB优势:
* DML操作支持ACID模型(关于ACID，可以看下之前的这篇文章)，事务的提交，回滚，以及在服务器崩溃后的恢复能力；
* 具有的行级锁和Oracle风格的一致性读，以提升多用户的并发访问性能；
* InnoDB表会基于主键为查询操作作一些存储优化，每一个InnoDB表都具有一个叫作聚簇索引的主键索引，使得在进行主键查询时，可以最小化I/O操作；
* 为了保证数据完整性，InnoDB支持外键约束。通过外键，可以在进行数据插入，更新，删除时，对数据进行校验，以避免不同表之间的数据不一致问题。

## 对比MyISAM的优势:
* 如果你的服务器因为硬件或软件原因导致崩溃，重启数据库后，并不需要作额外的工作，InnoDB将自动恢复处理，比如执行完崩溃前已经提交的事务，回滚未提交的事务等；
* InnoDB存储引擎会维护自己的缓冲池，用于将表和索引数据缓存在内存中，因此频繁使用的数据将直接从内存中获取。对于专用的数据库服务器上，基本可以使用80%的内存用于该缓冲池；
* 对于不同表之间的数据，InnoDB提供了外键约束来保证数据完整性。
* 如果数据在内存或磁盘中损坏，InnoDB的校验和机制会在你使用该数据前，作出提醒；
* 如果使用的InnoDB表具有主键列，那么涉及到主键列的一些操作会自动被优化，比如WHERE，ORDER BY，GROUP BY等子句，或join操作；
* 插入，更新，删除操作将被名为写缓冲区的机制自动优化，InnoDB不仅允许并发读写相同的表，并且能缓存更新的数据，以简化磁盘I/O操作；
* 性能优势并不会受限于对大型表的长时间运行的查询操作，当表中某一行记录被反复访问时，InnoDB的自适应哈希索引将使得这些查询变得更快，类似于从哈希表中获取数据；
* InnoDB允许压缩表和相关的索引；
* 创建或删除索引对性能和可用性影响很小；
* 执行Truncate表十分高效，并能及时释放对应的磁盘空间供操作系统重用，而不是供InnoDB引擎重用；
* 通过动态的行格式，对BLOB或长文本数据类型的数据存储更有效；
* 可以通过INFORMATION_SCHEMA表的数据监控存储引擎的内部运行状况；
* 可以通过Performance Schema表的数据监控存储引擎的性能细节；
* 可以混用InnoDB存储引擎与其他存储引擎，比如在同一个查询中join不同存储引擎的表；
* InnoDB在作处理大数据量时，针对CPU效率和最大性能作了针对设计；
* InnoDB能够处理大量数据，即使操作系统的文件大小限制为2G。

## InnoDB使用最佳实践:
* 为每张表指定一个主键，通常为需要频繁查询的列，如果没有明显的主键，可以指定一个自增列；
* 在使用JOIN时，尽量基于记录ID(主键)。使用外键时，为了提升性能关联列与被关联列应尽量使用相同数据类型。添加外建时，也尽量为被关联列添加索引；
* 关闭自动提交，每秒成百上千次提交将直接影响性能(受限于存储设备的写速度)；
* 将多个相关的DML操作通过START TRANSACTION和COMMIT包装为一个事务 ；
* 不要使用锁表语句，InnoDB表支持行锁( SELECT ... FOR UPDATE)，允许并发读写同一张表的不同记录；
* 评估数据存储和访问模式，是否会受益于compression特性(CREATE TABLE时指定ROW_FORMAT=COMPRESSED)；
* 运行Mysql Server时开启选项--sql_mode=NO_ENGINE_SUBSTITUTION，禁止表以不同的存储引擎创建，若有特例，可以通过CREATE TABLE的ENGINE=子句来指定。

## InnoDB与ACID模型:

### Atomicity(原子性)
> InnoDB中原子性主要体现在事务：
> * 自动提交(Autocommit)设置；
> * COMMIT语句；
> * ROLLBACK语句；
> * INFORMATION_SCHEMA表中可操作的数据；

### Consistency(一致性)
> InnoDB中一致性主要体现在当服务器崩溃时，能保护数据：
> * InnoDB的双写缓冲区(一种新型的文件刷新技术)；
> * InnoDB的故障恢复 ；
> * ROLLBACK语句；
> * INFORMATION_SCHEMA表中可操作的数据；

### Isolation(隔离性)
> InnoDB中隔离性主要体现在事务，特别是隔离级别，与MySQL相关的特性有：
> * 自动提交(Autocommit)设置；
> * SET ISOLATION LEVEL语句；

### Durability(持久性)
> InnoDB中持久性主要体现在特性硬件上的影响，由于涉及到CPU，网络和存储设备等多个因素，若要提供出具体的配置策略方案，会比较困难。与持久性相关的MySQL特性大致有：
> * InnoDB的双写缓冲区，可通过innodb_doublewrite选项来开启或关闭；
> * innodb_flush_log_at_trx_commit配置选项；
> * sync_binlog配置选项；
> * innodb_file_per_table配置选项；
> * 存储设备中的写缓冲区，如磁盘驱动，SSD，或RAID阵列；
> * 运行MySQL的操作系统，特别是支持fsync()系统调用；
> * 对运行MySQL和保存MySQL数据的服务器，提供UPS保障；
> * 备份策略，如备份频率，备份类型，及备份保留时间；
> * 对于分布式和托管数据的应用，MySQL服务器所在的数据中心的硬件特性，及数据中心间的网络连接；
